# Requirements Archive: v1.1 Extract viscy-data

**Archived:** 2026-02-14
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: VisCy Modularization

**Defined:** 2025-01-27
**Core Value:** Independent, reusable subpackages with clean import paths

## v1.0 Requirements (Complete)

### Workspace Foundation

- [x] **WORK-00**: Clean slate setup - wipe repo keeping only LICENSE, CITATION.cff, .gitignore
- [x] **WORK-01**: Virtual workspace root with `[tool.uv.workspace]` and `members = ["packages/*"]`
- [x] **WORK-02**: Shared lockfile (`uv.lock`) at repository root
- [x] **WORK-03**: Python version floor (>=3.11) enforced in root pyproject.toml
- [x] **WORK-04**: Pre-commit hooks configured (ruff, prek) for local development
- [x] **WORK-05**: Shared pytest configuration in root pyproject.toml

### Package Structure (viscy-transforms)

- [x] **PKG-01**: src layout for viscy-transforms (`packages/viscy-transforms/src/viscy_transforms/`)
- [x] **PKG-02**: Package pyproject.toml with hatchling build backend
- [x] **PKG-03**: uv-dynamic-versioning configured for git-based versioning
- [x] **PKG-04**: Package README.md with installation and usage instructions

### Code Migration (viscy-transforms)

- [x] **MIG-01**: All transform modules migrated from `viscy/transforms/` to package
- [x] **MIG-02**: All transform tests migrated from `tests/transforms/` to `packages/viscy-transforms/tests/`
- [x] **MIG-03**: Import path updated to `from viscy_transforms import X`
- [x] **MIG-04**: All migrated tests passing with `uv run --package viscy-transforms pytest`
- [x] **MIG-05**: Original `viscy/transforms/` directory removed

### CI/CD

- [x] **CI-01**: GitHub Actions workflow for testing viscy-transforms package
- [x] **CI-03**: Matrix testing across Python 3.11, 3.12, 3.13 on 3 OSes
- [x] **CI-04**: Linting via prek (uvx prek) in CI workflows

## v1.1 Requirements

Requirements for extracting viscy-data as the second independent subpackage.

### Package Structure

- [ ] **DATA-PKG-01**: viscy-data package at `packages/viscy-data/src/viscy_data/` with hatchling + uv-dynamic-versioning
- [ ] **DATA-PKG-02**: Optional dependency groups `[triplet]`, `[livecell]`, `[mmap]`, `[all]` in pyproject.toml
- [ ] **DATA-PKG-03**: No dependency on viscy-transforms; remove BatchedCenterSpatialCropd from triplet.py, assert batch shape instead
- [ ] **DATA-PKG-04**: Shared utilities (`_ensure_channel_list`, `_read_norm_meta`, `_collate_samples`, channel scatter/gather helpers) extracted from hcs.py and triplet.py into `_utils.py`

### Code Migration

- [ ] **DATA-MIG-01**: All 13 data modules migrated to `packages/viscy-data/src/viscy_data/` with updated import paths
- [ ] **DATA-MIG-02**: Flat top-level exports in `__init__.py` for all DataModules, Datasets, and types
- [ ] **DATA-MIG-03**: Lazy imports for optional dependencies (tensorstore, tensordict, pycocotools, pandas, tifffile, torchvision) with clear install-instruction error messages
- [ ] **DATA-MIG-04**: Internal imports use absolute `viscy_data.` prefix, not relative imports

### Testing

- [ ] **DATA-TST-01**: All existing data tests (`test_hcs.py`, `test_triplet.py`, `test_select.py`) passing under new import paths
- [ ] **DATA-TST-02**: Smoke tests verifying `import viscy_data` works without optional extras and produces correct error messages when optional modules are used

### CI/CD

- [ ] **DATA-CI-01**: GitHub Actions test workflow extended with viscy-data jobs
- [ ] **DATA-CI-02**: Tiered CI matrix: base deps (3 OS x 3 Python) + full extras (narrower matrix)

## Future Requirements

Deferred to later milestones.

### Documentation
- **DOC-01**: Zensical documentation with GitHub Pages (deferred from v1.0)
- **DOC-02**: API reference auto-generated from docstrings

### Future Package Extractions
- **PKG-10**: Extract viscy-models package (unet, representation, translation)
- **PKG-11**: Extract viscy-airtable package
- **PKG-12**: viscy meta-package with CLI and optional re-exports

### Refactoring
- **REF-01**: GPU transform protocol/mixin (GPUTransformMixin) for interface standardization
- **REF-02**: Split combined.py into combined.py + concat.py
- **REF-03**: Abstract cache interface across Manager.dict, tensorstore, MemoryMappedTensor

## Out of Scope

| Feature | Reason |
|---------|--------|
| Backward-compatible `viscy.data` imports | Clean break established in v1.0 |
| Unified batch structure across pipelines | Different pipelines have fundamentally different batch semantics |
| Auto-detect pipeline type from config | Defeats modularity |
| Split into multiple data packages | Over-fragmentation for 13 modules |
| Re-export MONAI transforms | Creates import surface confusion |
| Hydra integration | Per design doc, deferred |

## Traceability

### v1.0 (Complete)

| Requirement | Phase | Status |
|-------------|-------|--------|
| WORK-00 | Phase 1 | Complete |
| WORK-01 | Phase 1 | Complete |
| WORK-02 | Phase 1 | Complete |
| WORK-03 | Phase 1 | Complete |
| WORK-04 | Phase 1 | Complete |
| WORK-05 | Phase 1 | Complete |
| PKG-01 | Phase 2 | Complete |
| PKG-02 | Phase 2 | Complete |
| PKG-03 | Phase 2 | Complete |
| PKG-04 | Phase 2 | Complete |
| MIG-01 | Phase 3 | Complete |
| MIG-02 | Phase 3 | Complete |
| MIG-03 | Phase 3 | Complete |
| MIG-04 | Phase 3 | Complete |
| MIG-05 | Phase 3 | Complete |
| CI-01 | Phase 5 | Complete |
| CI-03 | Phase 5 | Complete |
| CI-04 | Phase 5 | Complete |

### v1.1 (Active)

| Requirement | Phase | Status |
|-------------|-------|--------|
| DATA-PKG-01 | Phase 6 | Pending |
| DATA-PKG-02 | Phase 6 | Pending |
| DATA-PKG-03 | Phase 7 | Pending |
| DATA-PKG-04 | Phase 6 | Pending |
| DATA-MIG-01 | Phase 7 | Pending |
| DATA-MIG-02 | Phase 7 | Pending |
| DATA-MIG-03 | Phase 7 | Pending |
| DATA-MIG-04 | Phase 7 | Pending |
| DATA-TST-01 | Phase 8 | Pending |
| DATA-TST-02 | Phase 8 | Pending |
| DATA-CI-01 | Phase 9 | Pending |
| DATA-CI-02 | Phase 9 | Pending |

**Coverage:**
- v1.0 requirements: 18 total, 18 complete
- v1.1 requirements: 12 total
- Mapped to phases: 12
- Unmapped: 0

---
*Requirements defined: 2025-01-27*
*Last updated: 2026-02-13 after v1.1 roadmap creation*
