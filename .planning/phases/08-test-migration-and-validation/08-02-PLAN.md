---
phase: 08-test-migration-and-validation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/viscy-data/tests/test_smoke.py
autonomous: true

must_haves:
  truths:
    - "`import viscy_data` succeeds without error"
    - "All 45 names in `viscy_data.__all__` are importable via `getattr(viscy_data, name)`"
    - "Lazy import guards produce error messages containing `pip install 'viscy-data[` install instructions"
  artifacts:
    - path: "packages/viscy-data/tests/test_smoke.py"
      provides: "Smoke tests for import, __all__ completeness, and optional dep error messages"
      contains: "test_import_viscy_data"
  key_links:
    - from: "packages/viscy-data/tests/test_smoke.py"
      to: "packages/viscy-data/src/viscy_data/__init__.py"
      via: "import viscy_data and __all__ iteration"
      pattern: "import viscy_data"
---

<objective>
Create smoke tests verifying that `import viscy_data` works correctly and that optional-dependency error messages contain proper install instructions.

Purpose: Satisfies DATA-TST-02 -- smoke tests for basic import, __all__ completeness, and optional dep error guidance.
Output: `packages/viscy-data/tests/test_smoke.py` passing under `uv run --package viscy-data pytest`.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/viscy-data/src/viscy_data/__init__.py (45 exports in __all__)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test_smoke.py with import, __all__, and error message tests</name>
  <files>packages/viscy-data/tests/test_smoke.py</files>
  <action>
Create `packages/viscy-data/tests/test_smoke.py` with the following tests:

**Test 1: `test_import_viscy_data`**
- Simply `import viscy_data` and assert it has `__all__` attribute.
- This verifies the base package imports without error.

**Test 2: `test_all_exports_importable`**
- Import `viscy_data`, iterate over `viscy_data.__all__`, and verify each name is accessible via `getattr(viscy_data, name)`.
- Use a parametrized test: `@pytest.mark.parametrize("name", viscy_data.__all__)` so each export shows as a separate test case.
- Assert `getattr(viscy_data, name)` does not raise `AttributeError`.

**Test 3: `test_all_count`**
- Assert `len(viscy_data.__all__) == 45` to catch accidental additions/removals.

**Test 4: `test_optional_dep_error_messages` (parametrized)**
- This tests that the lazy import guard code paths contain the correct `pip install` hints.
- Since all optional deps may be installed in the test env, we CANNOT trigger the guards directly.
- Instead, use `inspect.getsource()` to verify the error message patterns exist in the module source code.
- Parametrize over these module/pattern pairs:
  - `("viscy_data.triplet", "pip install 'viscy-data[triplet]'")`
  - `("viscy_data.mmap_cache", "pip install 'viscy-data[mmap]'")`
  - `("viscy_data.livecell", "pip install 'viscy-data[livecell]'")`
  - `("viscy_data.cell_classification", "pip install 'viscy-data[triplet]'")`
- For each: `import importlib; mod = importlib.import_module(module_name); src = inspect.getsource(mod); assert pattern in src`

**Test 5: `test_no_viscy_dependency`**
- Verify `viscy_data` does not depend on the old `viscy` package.
- `import viscy_data` should not add `viscy` to `sys.modules` (check `"viscy" not in sys.modules` or `"viscy.data" not in sys.modules`).
- Note: if `viscy` happens to be installed, skip with a clear message. Use:
  ```python
  import sys
  # Reload to check fresh import
  import viscy_data
  # Check that importing viscy_data did not pull in viscy.data
  assert "viscy.data" not in sys.modules, "viscy_data should not import from viscy.data"
  ```

Keep the file clean and well-documented with docstrings explaining the testing strategy.
  </action>
  <verify>
Run: `uv run --package viscy-data pytest packages/viscy-data/tests/test_smoke.py -v`
All smoke tests must pass. The parametrized `test_all_exports_importable` should show 45 individual PASSED lines.
  </verify>
  <done>test_smoke.py exists with 5 test functions (some parametrized) covering import, __all__ completeness (45 names), optional dep error messages (4 modules), and no-viscy-dependency check. All pass.</done>
</task>

</tasks>

<verification>
Smoke test verification:
```bash
uv run --package viscy-data pytest packages/viscy-data/tests/test_smoke.py -v --tb=short
```

Full suite (combined with Plan 01 tests):
```bash
uv run --package viscy-data pytest packages/viscy-data/tests/ -v --tb=short
```
</verification>

<success_criteria>
1. `uv run --package viscy-data pytest packages/viscy-data/tests/test_smoke.py` -- all pass
2. All 45 `__all__` names individually verified importable
3. 4 optional dep modules verified to contain `pip install` error message patterns
4. No `viscy.data` in sys.modules after importing viscy_data
5. DATA-TST-02 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/08-test-migration-and-validation/08-02-SUMMARY.md`
</output>
