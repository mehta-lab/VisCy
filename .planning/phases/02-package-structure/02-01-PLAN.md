---
phase: 02-package-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/viscy-transforms/src/viscy_transforms/__init__.py
  - packages/viscy-transforms/src/viscy_transforms/py.typed
  - packages/viscy-transforms/tests/__init__.py
  - packages/viscy-transforms/pyproject.toml
  - packages/viscy-transforms/README.md
autonomous: true

must_haves:
  truths:
    - "Package structure exists at packages/viscy-transforms/src/viscy_transforms/"
    - "Package is installable via uv pip install -e"
    - "Import viscy_transforms does not error (empty package is fine)"
    - "py.typed marker is present for type checker support"
  artifacts:
    - path: "packages/viscy-transforms/src/viscy_transforms/__init__.py"
      provides: "Package entry point with empty __all__"
      contains: "__all__"
    - path: "packages/viscy-transforms/pyproject.toml"
      provides: "Package metadata and build configuration"
      contains: "hatchling"
    - path: "packages/viscy-transforms/README.md"
      provides: "Installation and usage documentation"
      min_lines: 20
  key_links:
    - from: "packages/viscy-transforms/pyproject.toml"
      to: "packages/viscy-transforms/src/viscy_transforms"
      via: "wheel packages config"
      pattern: "packages.*src/viscy_transforms"
---

<objective>
Create viscy-transforms package skeleton with modern build system (hatchling + uv-dynamic-versioning).

Purpose: Establish proper package structure before code migration (Phase 3). This enables editable install and sets up the foundation for independent releases.

Output: A complete package skeleton with:
- src layout directory structure
- pyproject.toml with hatchling build backend and uv-dynamic-versioning
- README.md with installation instructions
- py.typed marker for type hint support
</objective>

<execution_context>
@/Users/sricharan.varra/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sricharan.varra/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-package-structure/02-CONTEXT.md
@.planning/phases/02-package-structure/02-RESEARCH.md
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create package directory structure</name>
  <files>
    packages/viscy-transforms/src/viscy_transforms/__init__.py
    packages/viscy-transforms/src/viscy_transforms/py.typed
    packages/viscy-transforms/tests/__init__.py
  </files>
  <action>
Create the src layout directory structure for viscy-transforms package:

1. Create directories:
   - `packages/viscy-transforms/src/viscy_transforms/`
   - `packages/viscy-transforms/tests/`

2. Create `__init__.py` in `packages/viscy-transforms/src/viscy_transforms/`:
```python
"""VisCy Transforms - Image transforms for virtual staining microscopy.

This package provides PyTorch-based image transforms for preprocessing
microscopy data in virtual staining workflows. Transforms follow the
MONAI Dictionary transform pattern for use with DataLoader pipelines.

Public API:
    All transforms are exported at the package level.
    Example: `from viscy_transforms import NormalizeSampled`

Version:
    Use `importlib.metadata.version('viscy-transforms')` to get version.
"""

# Public API - will be populated during code migration (Phase 3)
# All transforms should be importable directly from viscy_transforms
__all__: list[str] = []
```

3. Create empty `py.typed` marker file:
   - File: `packages/viscy-transforms/src/viscy_transforms/py.typed`
   - Content: empty file (its presence is the marker)

4. Create `__init__.py` in `packages/viscy-transforms/tests/`:
```python
"""Tests for viscy-transforms package."""
```

5. Remove `packages/.gitkeep` since we now have actual content.

This establishes PKG-01 (src layout structure).
  </action>
  <verify>
    - `ls -la packages/viscy-transforms/src/viscy_transforms/` shows __init__.py and py.typed
    - `ls -la packages/viscy-transforms/tests/` shows __init__.py
    - `test -f packages/viscy-transforms/src/viscy_transforms/py.typed && echo "py.typed exists"`
  </verify>
  <done>
    - src layout directory structure exists
    - __init__.py has docstring and empty __all__
    - py.typed marker present
    - tests directory initialized
  </done>
</task>

<task type="auto">
  <name>Task 2: Create package pyproject.toml</name>
  <files>
    packages/viscy-transforms/pyproject.toml
  </files>
  <action>
Create pyproject.toml for viscy-transforms with hatchling and uv-dynamic-versioning:

```toml
# ============================================================================
# viscy-transforms Package Configuration
# ============================================================================
# Image transforms for virtual staining microscopy.
# Part of the VisCy monorepo: https://github.com/mehta-lab/VisCy

# ============================================================================
# Build System
# ============================================================================

[build-system]
requires = ["hatchling", "uv-dynamic-versioning"]
build-backend = "hatchling.build"

# ============================================================================
# Project Metadata
# ============================================================================

[project]
name = "viscy-transforms"
dynamic = ["version"]
description = "Image transforms for virtual staining microscopy"
readme = "README.md"
requires-python = ">=3.11"
license = "BSD-3-Clause"
authors = [
    { name = "CZ Biohub SF", email = "compmicro@czbiohub.org" },
]
keywords = [
    "microscopy",
    "virtual staining",
    "image transforms",
    "deep learning",
    "pytorch",
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Science/Research",
    "License :: OSI Approved :: BSD License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Topic :: Scientific/Engineering :: Image Processing",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
]
dependencies = [
    "torch>=2.4.1",
    "kornia",
    "monai>=1.4",
    "numpy",
]

[project.urls]
Homepage = "https://github.com/mehta-lab/VisCy"
Repository = "https://github.com/mehta-lab/VisCy"
Documentation = "https://mehta-lab.github.io/VisCy/"
Issues = "https://github.com/mehta-lab/VisCy/issues"

# ============================================================================
# Hatch Build Configuration
# ============================================================================

[tool.hatch.version]
source = "uv-dynamic-versioning"

[tool.hatch.build.targets.wheel]
packages = ["src/viscy_transforms"]

# ============================================================================
# uv-dynamic-versioning Configuration
# ============================================================================
# Tag pattern: viscy-transforms-v0.1.0 -> version 0.1.0
# Fallback for CI environments without tags (Dependabot, shallow clones)

[tool.uv-dynamic-versioning]
vcs = "git"
style = "pep440"
pattern-prefix = "viscy-transforms-"
fallback-version = "0.0.0"

# ============================================================================
# Dependency Groups (PEP 735)
# ============================================================================
# Inherit test dependencies from workspace root

[dependency-groups]
test = [
    { include-group = "test" },
]
```

This establishes PKG-02 (hatchling) and PKG-03 (uv-dynamic-versioning).
  </action>
  <verify>
    - `grep -q "hatchling" packages/viscy-transforms/pyproject.toml && echo "hatchling found"`
    - `grep -q "uv-dynamic-versioning" packages/viscy-transforms/pyproject.toml && echo "uv-dynamic-versioning found"`
    - `grep -q 'pattern-prefix = "viscy-transforms-"' packages/viscy-transforms/pyproject.toml && echo "pattern-prefix found"`
  </verify>
  <done>
    - pyproject.toml exists with hatchling build backend
    - uv-dynamic-versioning configured with pattern-prefix
    - Dependencies specified (torch, kornia, monai, numpy)
    - Project metadata complete (author, license, classifiers)
  </done>
</task>

<task type="auto">
  <name>Task 3: Create README.md and verify install</name>
  <files>
    packages/viscy-transforms/README.md
  </files>
  <action>
1. Create README.md for viscy-transforms package:

```markdown
# viscy-transforms

Image transforms for virtual staining microscopy.

Part of the [VisCy](https://github.com/mehta-lab/VisCy) project.

## Installation

### From PyPI (when published)

```bash
pip install viscy-transforms
```

### For development (from monorepo root)

```bash
# Using uv (recommended)
uv pip install -e packages/viscy-transforms

# Or via workspace sync
uv sync --package viscy-transforms
```

## Usage

```python
from viscy_transforms import NormalizeSampled, RandAffineTransformSampled

# Transforms follow MONAI dictionary transform pattern
# See documentation for full API reference
```

## Features

- PyTorch-based image transforms optimized for microscopy data
- MONAI Dictionary transform compatibility for DataLoader pipelines
- Kornia-accelerated augmentations (affine, noise, blur)
- Specialized transforms for virtual staining workflows

## Dependencies

- `torch>=2.4.1`
- `kornia`
- `monai>=1.4`
- `numpy`

## Documentation

Full documentation available at [mehta-lab.github.io/VisCy](https://mehta-lab.github.io/VisCy/).

## License

BSD-3-Clause - see [LICENSE](../../LICENSE) in repository root.
```

2. Verify editable install works:
   - Run `uv sync` at workspace root to pick up the new package
   - Run `uv pip install -e packages/viscy-transforms`
   - Run `uv run python -c "import viscy_transforms; print(viscy_transforms.__all__)"`

3. Run pre-commit hooks to verify package passes linting:
   - Run `uvx prek run --all-files`

This establishes PKG-04 (README.md with installation instructions).
  </action>
  <verify>
    - `test -f packages/viscy-transforms/README.md && echo "README exists"`
    - `uv sync` completes without error
    - `uv run python -c "import viscy_transforms; print('import success')"` outputs "import success"
    - `uvx prek run --all-files` passes (or shows "Skipped" for empty dirs)
  </verify>
  <done>
    - README.md exists with installation and usage instructions
    - Package is installable via uv pip install -e
    - Import viscy_transforms succeeds (empty __all__ is expected)
    - Pre-commit hooks pass on new package files
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify Phase 2 success criteria from ROADMAP.md:

1. `packages/viscy-transforms/src/viscy_transforms/__init__.py` exists with proper structure
2. Package pyproject.toml uses hatchling with uv-dynamic-versioning
3. `uv pip install -e packages/viscy-transforms` succeeds
4. Package README.md documents installation and basic usage

Commands to verify:
```bash
# Check directory structure
ls -la packages/viscy-transforms/src/viscy_transforms/
ls -la packages/viscy-transforms/tests/

# Check pyproject.toml content
cat packages/viscy-transforms/pyproject.toml | head -30

# Test import
uv run python -c "import viscy_transforms; print('Success:', viscy_transforms.__all__)"

# Check README exists and has content
wc -l packages/viscy-transforms/README.md
```
</verification>

<success_criteria>
- Package skeleton complete at `packages/viscy-transforms/`
- All 4 PKG requirements satisfied (PKG-01 through PKG-04)
- Package installable and importable (empty but valid)
- Ready for code migration in Phase 3
</success_criteria>

<output>
After completion, create `.planning/phases/02-package-structure/02-01-SUMMARY.md`
</output>
