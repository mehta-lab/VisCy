---
phase: 01-workspace-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - .gitignore
  - packages/.gitkeep
  - scripts/.gitkeep
autonomous: true

must_haves:
  truths:
    - "`uv sync` runs without errors at repository root"
    - "Repository contains LICENSE, CITATION.cff, .gitignore, pyproject.toml, packages/, scripts/"
    - "Python >=3.11 constraint enforced when attempting installation"
    - "Old code (viscy/, tests/, docs/, applications/, examples/) removed from working tree"
  artifacts:
    - path: "pyproject.toml"
      provides: "uv workspace definition + meta-package + tool config"
      contains: "[tool.uv.workspace]"
    - path: "uv.lock"
      provides: "Shared lockfile for workspace"
      min_lines: 5
    - path: "packages/.gitkeep"
      provides: "Workspace members directory"
    - path: "scripts/.gitkeep"
      provides: "Workspace utilities directory"
  key_links:
    - from: "pyproject.toml"
      to: "packages/*"
      via: "[tool.uv.workspace] members glob"
      pattern: 'members = \["packages/\*"\]'
---

<objective>
Establish a clean uv workspace with pyproject.toml configuration from a clean slate.

Purpose: Transform the monolithic VisCy repository into a workspace-ready structure by removing old code and creating the foundational pyproject.toml with workspace configuration, tool settings, and dependency groups.

Output: A working uv workspace root with `uv sync` passing, empty packages/ directory, and all shared tool configuration in place.
</objective>

<execution_context>
@/Users/sricharan.varra/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sricharan.varra/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-workspace-foundation/01-CONTEXT.md
@.planning/phases/01-workspace-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean slate transition</name>
  <files>
    - viscy/ (delete)
    - tests/ (delete)
    - docs/ (delete)
    - applications/ (delete)
    - examples/ (delete)
    - README.md (delete)
    - CONTRIBUTING.md (delete)
    - pyproject.toml (delete old)
    - .pre-commit-config.yaml (delete old)
    - .readthedocs.yaml (delete)
    - .codecov.yml (delete)
    - .github/ (delete)
    - .gitattributes (delete)
    - packages/.gitkeep (create)
    - scripts/.gitkeep (create)
  </files>
  <action>
Remove all existing code and configuration files EXCEPT: LICENSE, CITATION.cff, .gitignore, .planning/

Use `git rm -rf` for tracked files and ensure:
- `viscy/` directory completely removed
- `tests/` directory completely removed
- `docs/` directory completely removed
- `applications/` directory completely removed
- `examples/` directory completely removed
- `README.md` file removed
- `CONTRIBUTING.md` file removed
- Old `pyproject.toml` file removed
- Old `.pre-commit-config.yaml` file removed
- `.readthedocs.yaml` file removed
- `.codecov.yml` file removed
- `.github/` directory removed (will rebuild in Phase 5)
- `.gitattributes` file removed

Create directory structure:
- `packages/` with `.gitkeep` file (workspace members)
- `scripts/` with `.gitkeep` file (workspace utilities)

Update `.gitignore` to include workspace-specific patterns:
- `uv.lock` should NOT be gitignored (tracked for reproducibility)
- Add `.venv/` if not present
- Add `__pycache__/` if not present
- Add `*.egg-info/` if not present

Do NOT commit yet - will commit after pyproject.toml is created.
  </action>
  <verify>
```bash
# Verify clean slate
ls -la  # Should only show: .claude, .git, .gitignore, .planning, .venv, CITATION.cff, LICENSE, packages, scripts

# Verify directories exist
test -d packages && echo "packages/ exists"
test -d scripts && echo "scripts/ exists"

# Verify old code removed
test ! -d viscy && echo "viscy/ removed"
test ! -d tests && echo "tests/ removed"
test ! -d docs && echo "docs/ removed"
```
  </verify>
  <done>Repository contains only LICENSE, CITATION.cff, .gitignore, .planning/, packages/, scripts/ and .venv/ (ignored)</done>
</task>

<task type="auto">
  <name>Task 2: Create workspace pyproject.toml</name>
  <files>pyproject.toml</files>
  <action>
Create the root pyproject.toml with:

**[project] section:**
- name = "viscy"
- version = "0.0.0" (placeholder meta-package)
- requires-python = ">=3.11"
- description = "VisCy workspace meta-package"
- license = "BSD-3-Clause"
- (NO readme yet - will add in Phase 3 after migration)

**[build-system] section:**
- requires = ["hatchling"]
- build-backend = "hatchling.build"

**[tool.uv.workspace] section:**
- members = ["packages/*"]

**[dependency-groups] section:**
- dev group with: pytest>=9.0.2, pytest-cov, ruff>=0.14.14

**[tool.ruff] section (per CONTEXT.md specs):**
- line-length = 120
- indent-width = 4
- target-version = "py311"
- src = ["packages/*/src"]

**[tool.ruff.format] section:**
- quote-style = "double"
- indent-style = "space"
- docstring-code-format = true
- skip-magic-trailing-comma = false

**[tool.ruff.lint] section:**
- select = ["E", "F", "W", "I", "D", "NPY", "PD"]

**[tool.ruff.lint.pydocstyle] section:**
- convention = "numpy"

**[tool.ruff.lint.per-file-ignores] section:**
- "__init__.py" = ["F401", "D104"]
- "tests/**" = ["D"]

**[tool.ty.environment] section:**
- python-version = "3.11"

**[tool.ty.rules] section:**
- unresolved-import = "warn"
- possibly-unresolved-reference = "warn"

**[tool.pytest.ini_options] section:**
- minversion = "9.0"
- testpaths = ["packages/*/tests"]
- addopts = ["-ra", "-q", "--import-mode=importlib"]
- pythonpath = ["."]

Use clear section headers with comments for organization.
  </action>
  <verify>
```bash
# Verify pyproject.toml structure
uv --no-project run python -c "import tomllib; t = tomllib.load(open('pyproject.toml', 'rb')); print('Valid TOML'); print('workspace:', t.get('tool', {}).get('uv', {}).get('workspace', {})); print('requires-python:', t.get('project', {}).get('requires-python'))"

# Verify workspace recognition
uv sync --dry-run 2>&1 | head -20
```
  </verify>
  <done>pyproject.toml exists with workspace configuration, Python >=3.11 constraint, and all tool settings</done>
</task>

<task type="auto">
  <name>Task 3: Initialize workspace and verify</name>
  <files>uv.lock</files>
  <action>
Run `uv sync` to:
1. Generate the shared `uv.lock` lockfile
2. Install dev dependencies in the workspace virtual environment
3. Validate workspace configuration is correct

After uv sync succeeds:
1. Verify uv.lock was created
2. Run `uv pip list` to confirm dev dependencies installed (pytest, ruff)
3. Run `uvx ruff check .` to verify ruff configuration works (should pass with no files to check)

Commit the clean slate transition with atomic commit:
```
feat(01-01): establish uv workspace foundation

- Clean slate: remove old monolithic code structure
- Create workspace pyproject.toml with meta-package
- Configure shared tooling: ruff, ty, pytest
- Initialize packages/ and scripts/ directories
- Generate uv.lock for reproducible builds

Requirements: WORK-00, WORK-01, WORK-02, WORK-03, WORK-05

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
  </action>
  <verify>
```bash
# Verify uv sync works
uv sync

# Verify lockfile exists
test -f uv.lock && echo "uv.lock created"

# Verify dev dependencies available
uv run pytest --version
uv run ruff --version

# Verify workspace structure
uv pip list | grep -E "(pytest|ruff)"
```
  </verify>
  <done>`uv sync` completes successfully, uv.lock exists, dev dependencies installed, changes committed</done>
</task>

</tasks>

<verification>
After all tasks complete:

```bash
# Full verification suite
echo "=== Workspace Structure ==="
ls -la

echo -e "\n=== Verify Clean Slate ==="
test ! -d viscy && echo "✓ viscy/ removed" || echo "✗ viscy/ still exists"
test ! -d tests && echo "✓ tests/ removed" || echo "✗ tests/ still exists"
test ! -d docs && echo "✓ docs/ removed" || echo "✗ docs/ still exists"

echo -e "\n=== Verify New Structure ==="
test -f pyproject.toml && echo "✓ pyproject.toml exists" || echo "✗ pyproject.toml missing"
test -f uv.lock && echo "✓ uv.lock exists" || echo "✗ uv.lock missing"
test -d packages && echo "✓ packages/ exists" || echo "✗ packages/ missing"
test -d scripts && echo "✓ scripts/ exists" || echo "✗ scripts/ missing"

echo -e "\n=== Verify uv Workspace ==="
uv sync 2>&1 | tail -5

echo -e "\n=== Verify Python Constraint ==="
uv --no-project run python -c "import tomllib; print('requires-python:', tomllib.load(open('pyproject.toml', 'rb'))['project']['requires-python'])"

echo -e "\n=== Verify Ruff Configuration ==="
uv run ruff check . --show-settings 2>&1 | head -10
```
</verification>

<success_criteria>
1. `uv sync` runs without errors
2. Repository contains only: LICENSE, CITATION.cff, .gitignore, .planning/, pyproject.toml, uv.lock, packages/, scripts/
3. Python >=3.11 constraint in pyproject.toml
4. Workspace members pattern: `packages/*`
5. Dev dependencies available: pytest, ruff
6. Ruff configured with: line-length=120, rules=[E,F,W,I,D,NPY,PD], numpy docstring convention
7. All changes committed with descriptive message
</success_criteria>

<output>
After completion, create `.planning/phases/01-workspace-foundation/01-01-SUMMARY.md`
</output>
